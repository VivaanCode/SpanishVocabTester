<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spanish Vocab Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f3efe8;
    }

    #quiz-box {
      max-width: 520px;
      margin: 20px auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 16px 0 #bbb;
      padding: 2em 1.5em 1em 1.5em;
    }

    @media (max-width: 600px) {
      #quiz-box {
        max-width: 99vw;
        padding: 1em 0.4em 0.7em 0.4em;
      }
      h2 { font-size: 1.08em; }
    }

    h2 {
      font-size: 1.2em;
      margin-bottom: 0.4em;
    }

    input[type="text"], button {
      font-size: 1.1em;
      width: 100%;
      padding: 0.6em;
      margin-top: 0.2em;
      border-radius: 5px;
      border: 1px solid #b1b1b1;
      box-sizing: border-box;
    }

    input[type='text']:focus {
      outline: 2px solid #adb5bd;
      background: #f8f9fa;
    }

    button {
      background: #388e3c;
      color: #fff;
      border: none;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 0.8em;
      transition: background 0.12s;
    }

    button:active, button:focus {
      background: #256029;
    }

    #check-btn {
      display: block;
    }

    @media (min-width: 601px) {
      #check-btn {
        display: none;
      }
    }

    #feedback {
      font-weight: bold;
      min-height: 24px;
      margin-top: 10px;
      transition: color 0.2s;
    }

    .stats-history-section {
      background: #f6f4ec;
      margin: 24px -24px 0 -24px;
      padding: 16px 24px 1px 24px;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
      box-sizing: border-box;
      overflow-x: auto;
    }

    @media (max-width: 600px) {
      .stats-history-section {
        margin: 18px -10px 0 -10px;
        padding: 14px 9px 0.5px 9px;
      }
    }

    .scorebox {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8em;
      font-size: 1.08em;
    }

    .scorebox .right { color: #1a7e24; }
    .scorebox .wrong { color: #d32f2f; }
    .score-label { font-variant: small-caps; }

    #history-list {
      list-style: none;
      margin: 0.5em 0 0 0;
      padding: 0;
      max-height: 180px;
      overflow-y: auto;
    }

    .history-item {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      margin-bottom: 4px;
      padding: 5px 0 5px 0;
      border-bottom: 1px dotted #e8e5c7;
    }

    .history-item:last-child { border-bottom: none; }
    .correct { color: #1b8c18; }
    .incorrect { color: #d32f2f; }
    .qeng { flex: 3; }
    .userans { flex: 2; padding-left: 12px; font-style: italic; }
    .corrans { flex: 2; padding-left: 12px; }

    @media (max-width:600px) {
      .scorebox { font-size: 0.99em; }
      .userans, .corrans { padding-left: 7px; }
    }

    /* Modal overlay (responsive) */
    #vocab-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    #vocab-modal.hidden {
      display: none;
    }

    .vocab-modal-content {
      background: #ffffff;
      max-width: 480px;
      width: 90vw;
      padding: 1.3em 1.1em 1.1em 1.1em;
      border-radius: 10px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.28);
      box-sizing: border-box;
    }

    .vocab-modal-content h3 {
      margin: 0 0 0.6em 0;
      font-size: 1.1em;
    }

    .vocab-modal-content p {
      margin: 0;
      font-size: 0.98em;
      line-height: 1.4;
    }

    .vocab-modal-content a {
      color: #1976d2;
      text-decoration: underline;
      word-break: break-word;
    }

    .vocab-modal-close {
      border: none;
      background: transparent;
      font-size: 1.4em;
      line-height: 1;
      cursor: pointer;
      float: right;
      margin-left: 0.5em;
      padding: 0;
    }

    @media (max-width: 480px) {
      .vocab-modal-content {
        width: 94vw;
        padding: 1.1em 0.9em 0.9em 0.9em;
      }
      .vocab-modal-content h3 {
        font-size: 1em;
      }
      .vocab-modal-content p {
        font-size: 0.94em;
      }
    }
  </style>
</head>

<body>
  <div id="quiz-box">
    <h2>Spanish Vocab Quiz (Complete)</h2>
    <div id="question"></div>
    <input type="text" id="answer" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
      placeholder="Type answer using accents if needed" />
    <button id="check-btn" onclick="checkAnswer()">✓ Check</button>
    <button onclick="checkAnswer()" style="display:none;">Check Answer</button>
    <div id="feedback"></div>
    <div class="stats-history-section">
      <div class="scorebox">
        <span class="score-label right">Right: <span id="right">0</span></span>
        <span class="score-label wrong">Wrong: <span id="wrong">0</span></span>
      </div>
      <div style="font-size:0.95em; color:#767; margin-bottom:8px;">History:</div>
      <ul id="history-list"></ul>
    </div>
  </div>

  <!-- Modal (opens on page load) -->
  <div id="vocab-modal" aria-modal="true" role="dialog">
    <div class="vocab-modal-content">
      <button class="vocab-modal-close" aria-label="Close notice">&times;</button>
      <h3>Vocabulary Update</h3>
      <p>
        Vocabulary updated for all final vocabulary. Full vocabulary list is
        <a href="https://docs.google.com/document/d/1QtoztlA2zzjpPAVj9qm7TAPvgp191pPXhWpu4yGYkOA/edit?usp=sharing"
           target="_blank" rel="noopener noreferrer">here</a>.
      </p>
    </div>
  </div>

  <script>
    // Complete vocabulary list (no duplicates, fixed C.R. entries)
    const vocab = [{eng: "Hello! / Hi!", esp: "¡Hola!"},
{eng: "Good morning, professor", esp: "Buenos días, profesor/profesora"},
{eng: "Good afternoon", esp: "Buenas tardes"},
{eng: "How are you? (informal)", esp: "¿Cómo estás?"},
{eng: "How are you? (formal)", esp: "¿Cómo está usted?"},
{eng: "I’m fine. And you?", esp: "Estoy bien. ¿Y tú?"},
{eng: "Great, thanks!", esp: "¡Muy bien, gracias!"},
{eng: "so-so, OK", esp: "más o menos"},
{eng: "OK, all right", esp: "regular"},
{eng: "bad, not well", esp: "mal"},
{eng: "Goodbye!", esp: "¡Adiós!"},
{eng: "Ciao!", esp: "¡Chao!"},
{eng: "See you!", esp: "¡Nos vemos!"},
{eng: "See you later!", esp: "¡Hasta luego!"},
{eng: "January", esp: "enero"},
{eng: "February", esp: "febrero"},
{eng: "March", esp: "marzo"},
{eng: "April", esp: "abril"},
{eng: "May", esp: "mayo"},
{eng: "June", esp: "junio"},
{eng: "July", esp: "julio"},
{eng: "August", esp: "agosto"},
{eng: "September", esp: "septiembre"},
{eng: "October", esp: "octubre"},
{eng: "November", esp: "noviembre"},
{eng: "December", esp: "diciembre"},
{eng: "Monday", esp: "lunes"},
{eng: "Tuesday", esp: "martes"},
{eng: "Wednesday", esp: "miércoles"},
{eng: "Thursday", esp: "jueves"},
{eng: "Friday", esp: "viernes"},
{eng: "Saturday", esp: "sábado"},
{eng: "Sunday", esp: "domingo"},
{eng: "summer", esp: "el verano"},
{eng: "autumn, fall", esp: "el otoño"},
{eng: "winter", esp: "el invierno"},
{eng: "spring", esp: "la primavera"},
{eng: "actor", esp: "el actor/la actriz"},
{eng: "artist", esp: "el/la artista"},
{eng: "athlete", esp: "el/la atleta"},
{eng: "dancer", esp: "el bailarín/la bailarina"},
{eng: "bilingual", esp: "bilingüe"},
{eng: "blogger", esp: "el/la bloguero/a"},
{eng: "cyclist", esp: "el/la ciclista"},
{eng: "classmate", esp: "el/la compañero/a de clase"},
{eng: "trainer, coach", esp: "el/la entrenador/a"},
{eng: "student", esp: "el/la estudiante"},
{eng: "photographer", esp: "el/la fotógrafo/a"},
{eng: "football (soccer) player", esp: "el/la futbolista"},
{eng: "gymnast", esp: "el/la gimnasta"},
{eng: "guitarist", esp: "el/la guitarrista"},
{eng: "poet", esp: "el poeta/la poeta"},
{eng: "vegetarian", esp: "el/la vegetariano/a"},
{eng: "volunteer", esp: "el/la voluntario/a"},
{eng: "to dance", esp: "bailar"},
{eng: "to eat", esp: "comer"},
{eng: "to write poems", esp: "escribir poemas"},
{eng: "to study", esp: "estudiar"},
{eng: "to listen to music", esp: "escuchar música"},
{eng: "to speak, talk", esp: "hablar"},
{eng: "to play (basketball)", esp: "jugar (al baloncesto)"},
{eng: "to watch movies", esp: "mirar películas"},
{eng: "to surf the web", esp: "navegar en/por internet"},
{eng: "to paint", esp: "pintar"},
{eng: "to practice sports", esp: "practicar deportes"},
{eng: "to play an instrument", esp: "tocar un instrumento"},
{eng: "to work", esp: "trabajar"},
{eng: "to live", esp: "vivir"},
{eng: "How? / What?", esp: "¿Cómo?"},
{eng: "Which one? / What?", esp: "¿Cuál?"},
{eng: "When?", esp: "¿Cuándo?"},
{eng: "How much?", esp: "¿Cuánto/a?"},
{eng: "How many?", esp: "¿Cuántos/as?"},
{eng: "Where (from)?", esp: "¿(De) dónde?"},
{eng: "Why?", esp: "¿Por qué?"},
{eng: "What?", esp: "¿Qué?"},
{eng: "What do you like to do?", esp: "¿Qué te gusta hacer?"},
{eng: "What’s your name?", esp: "¿Cómo te llamas?"},
{eng: "Why are you studying Spanish?", esp: "¿Por qué estudias español?"},
{eng: "Where are you from?", esp: "¿De dónde eres?"},
{eng: "What is your favorite sport?", esp: "¿Cuál es tu deporte favorito?"},
{eng: "How old are you?", esp: "¿Cuántos años tienes?"},
{eng: "When is your birthday?", esp: "¿Cuándo es tu cumpleaños?"},
{eng: "German", esp: "alemán"},
{eng: "Chinese", esp: "chino"},
{eng: "Spanish", esp: "español"},
{eng: "French", esp: "francés"},
{eng: "Guarani", esp: "guaraní"},
{eng: "English", esp: "inglés"},
{eng: "Italian", esp: "italiano"},
{eng: "Portuguese", esp: "portugués"},
{eng: "Russian", esp: "ruso"},
{eng: "Vietnamese", esp: "vietnamita"},
{eng: "also", esp: "también"},
{eng: "Me too!", esp: "¡Yo también!"},
{eng: "Interesting!", esp: "¡Qué interesante!"},
{eng: "Great!", esp: "¡Qué bueno!"},
{eng: "Too bad!", esp: "¡Qué pena!"},
{eng: "I have", esp: "Tengo . . ."},
{eng: "I need", esp: "Necesito . . ."},
{eng: "What do you need?", esp: "¿Qué necesitas?"},
{eng: "How much does it cost?", esp: "¿Cuánto cuesta?"},
{eng: "How much do they cost?", esp: "¿Cuánto cuestan?"},
{eng: "assignment notebook", esp: "la agenda escolar"},
{eng: "pen", esp: "el bolígrafo"},
{eng: "calculator", esp: "la calculadora"},
{eng: "folder", esp: "la carpeta"},
{eng: "computer", esp: "la computadora"},
{eng: "notebook", esp: "el cuaderno"},
{eng: "dictionary", esp: "el diccionario"},
{eng: "school", esp: "la escuela"},
{eng: "sheet of paper", esp: "la hoja de papel"},
{eng: "pencil; pencils", esp: "el lápiz/los lápices"},
{eng: "textbook", esp: "el libro de texto"},
{eng: "backpack", esp: "la mochila"},
{eng: "paper", esp: "el papel"},
{eng: "package", esp: "el paquete"},
{eng: "tablet computer", esp: "la táblet"},
{eng: "scissors", esp: "las tijeras"},
{eng: "shirt", esp: "la camisa"},
{eng: "logo; crest; emblem", esp: "el escudo"},
{eng: "skirt", esp: "la falda"},
{eng: "pants", esp: "los pantalones"},
{eng: "shoes", esp: "los zapatos"},
{eng: "white", esp: "blanco/a"},
{eng: "black", esp: "negro/a"},
{eng: "green", esp: "verde"},
{eng: "30", esp: "treinta"},
{eng: "40", esp: "cuarenta"},
{eng: "50", esp: "cincuenta"},
{eng: "60", esp: "sesenta"},
{eng: "70", esp: "setenta"},
{eng: "80", esp: "ochenta"},
{eng: "90", esp: "noventa"},
{eng: "100", esp: "cien/ciento"},
{eng: "200", esp: "doscientos"},
{eng: "1.000", esp: "mil"},
{eng: "lunch", esp: "el almuerzo"},
{eng: "science", esp: "la ciencia"},
{eng: "social studies", esp: "los estudios sociales"},
{eng: "geography", esp: "la geografía"},
{eng: "history", esp: "la historia"},
{eng: "computer science", esp: "la informática"},
{eng: "math", esp: "las matemáticas"},
{eng: "chemistry", esp: "la química"},
{eng: "break (between classes)", esp: "el recreo/el receso"},
{eng: "there is/there are", esp: "hay"},
{eng: "a/an/one", esp: "un/una"},
{eng: "some", esp: "unos/unas"},
{eng: "many", esp: "muchos/muchas"},
{eng: "auditorium", esp: "el auditorio"},
{eng: "classroom", esp: "el aula; el salón de clase"},
{eng: "library", esp: "la biblioteca"},
{eng: "cafeteria", esp: "el comedor/la soda (C.R.)"},
{eng: "soccer field", esp: "el campo de fútbol"},
{eng: "high school", esp: "el colegio (C.R.)"},
{eng: "building", esp: "el edificio"},
{eng: "gymnasium", esp: "el gimnasio"},
{eng: "laboratory", esp: "el laboratorio"},
{eng: "office", esp: "la oficina"},
{eng: "hallway", esp: "el pasillo"},
{eng: "swimming pool", esp: "la piscina"},
{eng: "(At) what time?", esp: "¿A qué hora?"},
{eng: "The class begins at . . .", esp: "La clase empieza a . . ."},
{eng: "The class ends at . . .", esp: "La clase termina a . . ."},
{eng: "schedule", esp: "el horario"},
{eng: "between classes", esp: "entre clases"},
{eng: "in the morning", esp: "por la mañana"},
{eng: "at noontime", esp: "al mediodía"},
{eng: "in the afternoon", esp: "por la tarde"},
{eng: "in the evening", esp: "por la noche"},
{eng: "on Saturdays", esp: "los sábados"},
{eng: "on Sundays", esp: "los domingos"},
{eng: "have lunch", esp: "almorzar (o → ue)"},
{eng: "help", esp: "ayudar"},
{eng: "walk", esp: "caminar"},
{eng: "sing", esp: "cantar"},
{eng: "teach", esp: "enseñar"},
{eng: "study", esp: "estudiar"},
{eng: "wear; to bring", esp: "llevar"},
{eng: "participate", esp: "participar"},
{eng: "pay attention", esp: "prestar atención"},
{eng: "go back home", esp: "regresar a casa"},
{eng: "take", esp: "tomar"},
{eng: "work in teams", esp: "trabajar en equipo"},
{eng: "use", esp: "usar"},
{eng: "bus", esp: "el autobús"},
{eng: "ceremony", esp: "la ceremonia"},
{eng: "classmate", esp: "el compañero de clase/la compañera de clase"},
{eng: "principal", esp: "el director/la directora"},
{eng: "national anthem", esp: "el himno nacional"},
{eng: "exchange", esp: "el intercambio"},
{eng: "teacher (particularly in elementary school)", esp: "el maestro/la maestra"},
{eng: "teacher", esp: "el profesor/la profesora"},
{eng: "secretary", esp: "el secretario/la secretaria"},
{eng: "This is my family", esp: "Esta es mi familia"},
{eng: "Who are they?", esp: "¿Quiénes son?"},
{eng: "grandfather/grandmother", esp: "el/la abuelo/a"},
{eng: "surname", esp: "el apellido"},
{eng: "baby", esp: "el/la bebé"},
{eng: "great-grandfather/mother", esp: "el/la bisabuelo/a"},
{eng: "husband/wife", esp: "el/la esposo/a"},
{eng: "cat", esp: "el gato"},
{eng: "son/daughter", esp: "el/la hijo/a"},
{eng: "brother/sister", esp: "el/la hermano/a"},
{eng: "mother", esp: "la madre"},
{eng: "pet", esp: "la mascota"},
{eng: "grandson/granddaughter", esp: "el/la nieto/a"},
{eng: "(given) name", esp: "el nombre"},
{eng: "father", esp: "el padre"},
{eng: "the parents", esp: "los padres"},
{eng: "dog", esp: "el perro"},
{eng: "cousin", esp: "el/la primo/a"},
{eng: "nephew/niece", esp: "el/la sobrino/a"},
{eng: "uncle/aunt", esp: "el/la tío/a"},
{eng: "What are they like?", esp: "¿Cómo son?"},
{eng: "tall", esp: "alto/a"},
{eng: "nice; kind", esp: "amable"},
{eng: "thin", esp: "delgado/a"},
{eng: "fat", esp: "gordo/a"},
{eng: "big", esp: "grande"},
{eng: "young", esp: "joven"},
{eng: "small", esp: "pequeño/a"},
{eng: "old", esp: "viejo/a"},
{eng: "happy", esp: "alegre"},
{eng: "quiet", esp: "callado/a"},
{eng: "fun", esp: "divertido/a"},
{eng: "polite", esp: "educado/a"},
{eng: "funny; comical", esp: "gracioso/a"},
{eng: "honest", esp: "honesto/a"},
{eng: "impatient", esp: "impaciente"},
{eng: "older (than)", esp: "mayor (que)"},
{eng: "younger (than)\n", esp: "menor (que)"},
{eng: "organized", esp: "ordenado/a"},
{eng: "serious", esp: "serio/a"},
{eng: "friendly", esp: "simpático/a"},
{eng: "unmarried; single", esp: "soltero/a"},
{eng: "talented", esp: "talentoso/a"},
{eng: "He is handsome/She is pretty", esp: "Es guapo/a"},
{eng: "He/She is dark complected", esp: "Es moreno/a"},
{eng: "He/she has blond hair", esp: "Tiene el pelo rubio"},
{eng: "He/she has dark hair", esp: "Tiene el pelo oscuro"},
{eng: "He/she is blond(e)", esp: "Es rubio/a"},
{eng: "He/she is a red-head", esp: "Es pelirrojo/a"},
{eng: "He/she has . . . eyes", esp: "Tiene los ojos . . ."},
{eng: "blue", esp: "azul"},
{eng: "brown", esp: "castaño/a"},
{eng: "brown", esp: "de color café"},
{eng: "black", esp: "negro/a"},
{eng: "green", esp: "verde"},
{eng: "apartment", esp: "el apartamento"},
{eng: "bathroom", esp: "el baño"},
{eng: "the house", esp: "la casa"},
{eng: "kitchen", esp: "la cocina"},
{eng: "dining room", esp: "el comedor"},
{eng: "bedroom", esp: "el dormitorio"},
{eng: "garage", esp: "el garaje"},
{eng: "garden; yard", esp: "el jardín"},
{eng: "patio", esp: "el patio"},
{eng: "floor; flat; apartment (Spain)", esp: "el piso"},
{eng: "living room", esp: "la sala"},
{eng: "terrace", esp: "la terraza"},
{eng: "to the right (of)", esp: "a la derecha (de)"},
{eng: "to the left (of)", esp: "a la izquierda (de)"},
{eng: "in the back (of)", esp: "al fondo (de)"},
{eng: "beside", esp: "al lado (de)"},
{eng: "behind", esp: "detrás (de)"},
{eng: "in the middle (of)", esp: "en medio (de)"},
{eng: "on a main street", esp: "en una avenida"},
{eng: "in the neighborhood", esp: "en el barrio"},
{eng: "in the country", esp: "en el campo"},
{eng: "in the city", esp: "en la ciudad"},
{eng: "on a quiet street", esp: "en una calle tranquila"},
{eng: "in the town", esp: "en el pueblo"},
{eng: "I have to", esp: "Tengo que"},
{eng: "I’m sorry.", esp: "Lo siento."},
{eng: "I can’t.", esp: "No puedo."},
{eng: "to ride a bicycle", esp: "andar en bicicleta"},
{eng: "to help", esp: "ayudar"},
{eng: "to eat dinner; supper", esp: "cenar"},
{eng: "to eat together", esp: "comer juntos"},
{eng: "to go for a walk/ride", esp: "dar un paseo"},
{eng: "to explore the city/the country", esp: "explorar la ciudad/el campo"},
{eng: "to get exercise", esp: "hacer ejercicio"},
{eng: "to play sports", esp: "jugar deportes"},
{eng: "to go to the movies", esp: "ir al cine"},
{eng: "to go out with friends", esp: "salir con amigos"},
{eng: "to watch television/a movie", esp: "ver la televisión/una película"},
{eng: "always", esp: "siempre"},
{eng: "every day", esp: "todos los días"},
{eng: "frequently; often", esp: "frecuentemente"},
{eng: "sometimes", esp: "a veces"},
{eng: "once (a week)", esp: "una vez (por semana)"},
{eng: "twice", esp: "dos veces"},
{eng: "never", esp: "nunca"},
{eng: "I prefer . . .", esp: "Yo prefiero…"},
{eng: "My own room", esp: "Mi propia habitación"},
{eng: "For me . . . is important.", esp: "Para mí es importante…"},
{eng: "What if we have . . . ?", esp: "¿Qué tal si tenemos… ?"},
{eng: "Don’t be silly!", esp: "¡No seas tonto/a!"},
{eng: "Agreed.", esp: "De acuerdo."},
{eng: "Susana is right.", esp: "Susana tiene razón."}
    ];
    let idx = 0, order = [], current = {};
    let right = 0, wrong = 0;
    const history = [];
    let allowInput = true;

    function normalizeAnswer(userInput, expected) {
      // Ultra-flexible normalization that accepts ANY variation
      const normalizeText = (text) => {
        return text
          .trim()
          .toLowerCase()
          // Normalize ALL dot variations to single dots with spaces
          .replace(/\.+/g, '.')           // multiple dots → single dot
          .replace(/\s*\.\s*/g, '. ')     // dot + any spaces → ". "
          .replace(/^\.+|\.+$/g, '')      // remove leading/trailing dots
          // Normalize ALL separator variations: / , | - → /
          .replace(/[|,|-]/g, '/')        // , | - → /
          .replace(/\s*\/\s*/g, '/')      // / with any spaces → /
          // Normalize multiple slashes
          .replace(/\/+/g, '/')
          // Normalize multiple spaces
          .replace(/\s+/g, ' ')
          .trim();
      };

      return {
        user: normalizeText(userInput),
        expected: normalizeText(expected)
      };
    }

    function initOrder() {
      order = [...Array(vocab.length).keys()].sort(() => Math.random() - 0.5);
      idx = 0;
    }

    function showQuestion() {
      allowInput = true;
      idx++;
      current = vocab[order[(idx - 1) % vocab.length]];
      const answerEl = document.getElementById('answer');

      document.getElementById('question').textContent = "Spanish for: " + current.eng;
      answerEl.value = '';
      document.getElementById('feedback').textContent = '';
      answerEl.disabled = false;

      answerEl.focus();
      answerEl.select();
    }

    function updateStatsAndHistory() {
      document.getElementById('right').textContent = right;
      document.getElementById('wrong').textContent = wrong;
      let html = '';
      for (let i = history.length - 1; i >= 0; i--) {
        const h = history[i];
        html += `<li class="history-item">
                    <span class="qeng">${h.eng}</span>
                    <span class="userans ${h.correct ? 'correct' : 'incorrect'}">${h.your}</span>
                    <span class="corrans">${h.correct ? '' : '→ ' + h.exp}</span>
                  </li>`;
      }
      document.getElementById('history-list').innerHTML = html;
    }

    function checkAnswer() {
      if (!allowInput) return;
      const answerEl = document.getElementById('answer');
      const userAns = answerEl.value;
      
      const normalized = normalizeAnswer(userAns, current.esp);

      if (normalized.user === normalized.expected) {
        document.getElementById('feedback').textContent = "Correct!";
        document.getElementById('feedback').style.color = "#118b0a";
        right++;
        history.push({eng: current.eng, your: userAns, exp: current.esp, correct: true});
      } else {
        document.getElementById('feedback').textContent = "Nope! It's: " + current.esp;
        document.getElementById('feedback').style.color = "#b8161a";
        wrong++;
        history.push({eng: current.eng, your: userAns, exp: current.esp, correct: false});
      }

      updateStatsAndHistory();
      allowInput = false;
      answerEl.disabled = true;
      setTimeout(showQuestion, 1500);
    }

    document.getElementById('answer').addEventListener('keyup', function (e) {
      if (e.key === "Enter") checkAnswer();
    });

    // Modal logic
    const vocabModal = document.getElementById('vocab-modal');
    const vocabModalClose = document.querySelector('.vocab-modal-close');

    function closeVocabModal() {
      vocabModal.classList.add('hidden');
      const answerEl = document.getElementById('answer');
      answerEl.focus();
      answerEl.select();
    }

    vocabModalClose.addEventListener('click', closeVocabModal);
    vocabModal.addEventListener('click', function (e) {
      if (e.target === vocabModal) closeVocabModal();
    });
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && !vocabModal.classList.contains('hidden')) {
        closeVocabModal();
      }
    });

    // Initialize
    initOrder();
    showQuestion();
    updateStatsAndHistory();
  </script>
</body>
</html>
